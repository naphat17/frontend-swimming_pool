<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö Admin Pools API</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .section h3 {
            color: #34495e;
            margin-top: 0;
        }
        input, button {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        button {
            background-color: #3498db;
            color: white;
            cursor: pointer;
            border: none;
        }
        button:hover {
            background-color: #2980b9;
        }
        .success {
            color: #27ae60;
            background-color: #d5f4e6;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error {
            color: #e74c3c;
            background-color: #fdf2f2;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .info {
            color: #2980b9;
            background-color: #ebf3fd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        pre {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .token-display {
            word-break: break-all;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèä‚Äç‚ôÇÔ∏è ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Admin Pools API</h1>
        
        <div class="info">
            <strong>üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</strong><br>
            1. Login ‡∏î‡πâ‡∏ß‡∏¢ admin credentials<br>
            2. ‡πÉ‡∏ä‡πâ token ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á admin pools endpoint<br>
            3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        </div>

        <!-- ‡∏™‡πà‡∏ß‡∏ô Login -->
        <div class="section">
            <h3>üîê 1. Admin Login</h3>
            <div>
                <input type="text" id="username" placeholder="Username" value="admin">
                <input type="password" id="password" placeholder="Password" value="admin123">
                <button onclick="adminLogin()">Login</button>
            </div>
            <div id="loginResult"></div>
            <div id="tokenDisplay"></div>
        </div>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö Pools API -->
        <div class="section">
            <h3>üèä‚Äç‚ôÇÔ∏è 2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Admin Pools API</h3>
            <div>
                <button onclick="testAdminPools()">GET /api/admin/pools</button>
                <button onclick="testAdminPoolsStatus()">GET /api/admin/pools/status</button>
            </div>
            <div id="poolsResult"></div>
        </div>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Debug -->
        <div class="section">
            <h3>üîç 3. Debug Information</h3>
            <div>
                <button onclick="checkTokenValidity()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Token</button>
                <button onclick="showRequestHeaders()">‡πÅ‡∏™‡∏î‡∏á Headers</button>
            </div>
            <div id="debugResult"></div>
        </div>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ -->
        <div class="section">
            <h3>üõ†Ô∏è 4. ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ 403 Forbidden</h3>
            <div class="info">
                <strong>‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:</strong><br>
                ‚Ä¢ ‡πÑ‡∏°‡πà‡∏°‡∏µ admin user ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö<br>
                ‚Ä¢ Token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)<br>
                ‚Ä¢ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á Authorization header<br>
                ‚Ä¢ Role ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà admin<br>
                ‚Ä¢ JWT Secret ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô<br><br>
                
                <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong><br>
                1. ‡∏™‡∏£‡πâ‡∏≤‡∏á admin user: <code>cd api && node scripts/create-admin.js</code><br>
                2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö server ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà port 3001<br>
                3. Login ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö token ‡πÉ‡∏´‡∏°‡πà<br>
                4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Authorization header
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://backend-l7q9.onrender.com/api';
        let currentToken = null;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Login
        async function adminLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('loginResult');
            const tokenDiv = document.getElementById('tokenDisplay');

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) {
                    currentToken = data.token;
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>
                            User: ${data.user.username}<br>
                            Role: ${data.user.role}<br>
                            Status: ${data.user.status}
                        </div>
                    `;
                    
                    tokenDiv.innerHTML = `
                        <div class="token-display">
                            <strong>üîë Token:</strong><br>
                            ${data.token}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            ‚ùå Login ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${data.message}
                        </div>
                    `;
                    tokenDiv.innerHTML = '';
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}<br>
                        ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ API Server ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà port 3001
                    </div>
                `;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö Admin Pools
        async function testAdminPools() {
            await testEndpoint('/admin/pools', 'GET');
        }

        async function testAdminPoolsStatus() {
            await testEndpoint('/admin/pools/status', 'GET');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö endpoint ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
        async function testEndpoint(endpoint, method = 'GET') {
            const resultDiv = document.getElementById('poolsResult');

            if (!currentToken) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡∏Å‡πà‡∏≠‡∏ô
                    </div>
                `;
                return;
            }

            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    method: method,
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ ${method} ${endpoint} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!
                        </div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            ‚ùå ${response.status} ${response.statusText}<br>
                            Endpoint: ${method} ${endpoint}<br>
                            Message: ${data.message || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°'}
                        </div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}
                    </div>
                `;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Token
        function checkTokenValidity() {
            const debugDiv = document.getElementById('debugResult');

            if (!currentToken) {
                debugDiv.innerHTML = `
                    <div class="error">
                        ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ Token
                    </div>
                `;
                return;
            }

            try {
                // Decode JWT token (‡πÅ‡∏Ñ‡πà payload, ‡πÑ‡∏°‡πà verify signature)
                const payload = JSON.parse(atob(currentToken.split('.')[1]));
                const now = Math.floor(Date.now() / 1000);
                const isExpired = payload.exp < now;

                debugDiv.innerHTML = `
                    <div class="${isExpired ? 'error' : 'success'}">
                        <strong>üîç Token Information:</strong><br>
                        User ID: ${payload.id}<br>
                        Username: ${payload.username}<br>
                        Role: ${payload.role}<br>
                        Issued At: ${new Date(payload.iat * 1000).toLocaleString('th-TH')}<br>
                        Expires At: ${new Date(payload.exp * 1000).toLocaleString('th-TH')}<br>
                        Status: ${isExpired ? '‚ùå ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß' : '‚úÖ ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ'}
                    </div>
                `;
            } catch (error) {
                debugDiv.innerHTML = `
                    <div class="error">
                        ‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ decode token: ${error.message}
                    </div>
                `;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á Headers
        function showRequestHeaders() {
            const debugDiv = document.getElementById('debugResult');

            if (!currentToken) {
                debugDiv.innerHTML = `
                    <div class="error">
                        ‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ Token
                    </div>
                `;
                return;
            }

            debugDiv.innerHTML = `
                <div class="info">
                    <strong>üìã Request Headers ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á:</strong>
                    <pre>{
  "Authorization": "Bearer ${currentToken.substring(0, 50)}...",
  "Content-Type": "application/json"
}</pre>
                </div>
            `;
        }

        // Auto-focus username field
        document.getElementById('username').focus();
    </script>
</body>
</html>